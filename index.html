<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Matthew's Musical Adventure!</title>
<link rel="stylesheet" href="./styleA.css">
<script src="./js/myFuncts.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<!-- leave what is repeatable for now -->
<!-- Sometimes when I comment things out, a 
    linter tries to use "hidden" braces and screw with my code -->
<body>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        //load Artists
        const artistURL = "starting-files/artists.json";
        const artistSel = document.querySelector("#artistSearch");
        const songSel = document.querySelector("#songSearch");
        const songSelByArt = document.querySelector("#songSearchByArt");
        //Now Fetching Artists
        fetch(artistURL)
            .then(response => response.json())
            .then(data => { populateArtists(data) })
        const optArt = document.createElement("option");
        optArt.textContent = "Pick an Artist";
        optArt.value = 0;
        artistSel.appendChild(optArt);
        // loadSongs();

        function populateArtists(artistData) {
            for (let art of artistData) {
                const optA = document.createElement("option");
                optA.textContent = art.name;
                optA.name = art.name;
                optA.id = art.id;
                optA.type = art.type;
                // optA.addEventListener("click", function () {
                //     this.classList.add("selected");
                // });
                artistSel.appendChild(optA);

            }//End of options being populated


        }
        artistSel.onclick = function (e) {
            if (e.target.tagName.toLowerCase() === 'option') {
                console.log(e.target.name + ' clicked');

                //only load the songs from the selected artist next+
                loadArtResults(e.target);
                songsDisplayed(e.target);


            }
        }
        //Now Fetching Songs
        const api = 'https://www.randyconnolly.com/funwebdev/3rd/api/music/songs-nested.php';
        // const songURL = "starting-files/sample-songs.json";


        // const songSelByArt = document.querySelector("#songSearchByArt");

        // const songSel = document.querySelector("#songSearch");


        fetch(api)
            .then(response => response.json())
            .then(data => { populateSongs(data) })
        const opt1 = document.createElement("option");
        opt1.textContent = "Pick a Song";
        opt1.value = 0;


        songSel.appendChild(opt1);
        songSelByArt.appendChild(opt1);

        function populateSongs(songData) {
            for (let s of songData) {
                const optS = document.createElement("option");
                optS.textContent = s.title;
                optS.songID = s.song_id;
                optS.title = s.title;
                optS.year = s.year;
                optS.artistID = s.artist.id;
                optS.artist = s.artist.name;
                optS.genreID = s.genre.id;
                optS.genre = s.genre.name;
                optS.durationInSec = s.details.duration;
                optS.bpm = s.details.bpm;
                optS.popul = s.details.popularity;
                optS.loudness = s.details.loudness;
                optS.energy = s.analytics.energy;
                optS.danceability = s.analytics.danceability;
                optS.liveness = s.analytics.liveness;
                optS.valence = s.analytics.valence;
                optS.acousticness = s.analytics.acousticness;
                optS.speechiness = s.analytics.speechiness;

                songSel.appendChild(optS);
                songSelByArt.appendChild(optS);

            }

        }
        songSel.addEventListener('click', function (e) {
            if (e.target.tagName.toLowerCase() === 'option') {
                console.log(e.target.title + ' clicked');

                loadSongResults(e.target);
                //pass in the song-object for the browse/search
                songsDisplayed(e.target);
                //takes you to selected song info
                const charti = document.querySelector("#right3");
                charti.style.display = "block";

                makeChart(e.target);
            }
        })
    });


                                                                                                                                    function loadSongs() {
                                                                                                                                        const api = 'https://www.randyconnolly.com/funwebdev/3rd/api/music/songs-nested.php';
            // const songURL = "starting-files/sample-songs.json";


                                                                                                                                    const songSelByArt = document.querySelector("#songSearchByArt");

                                                                                                                                    const songSel = document.querySelector("#songSearch");


                                                                                                                                    fetch(api)
                                                                                                                                        .then(response => response.json())
                                                                                                                                        .then(data => { populateSongs(data) })
                                                                                                                                    const opt1 = document.createElement("option");
                                                                                                                                    opt1.textContent = "Pick a Song";
                                                                                                                                    opt1.value = 0;


                                                                                                                                    songSel.appendChild(opt1);
                                                                                                                                    songSelByArt.appendChild(opt1);

                                                                                                                                    function populateSongs(songData) {
                                                                                                                                        for (let s of songData) {
                                                                                                                                            const optS = document.createElement("option");
                                                                                                                                            optS.textContent = s.title;
                                                                                                                                            optS.songID = s.song_id;
                                                                                                                                            optS.title = s.title;
                                                                                                                                            optS.year = s.year;
                                                                                                                                            optS.artistID = s.artist.id;
                                                                                                                                            optS.artist = s.artist.name;
                                                                                                                                            optS.genreID = s.genre.id;
                                                                                                                                            optS.genre = s.genre.name;
                                                                                                                                            optS.durationInSec = s.details.duration;
                                                                                                                                            optS.bpm = s.details.bpm;
                                                                                                                                            optS.popul = s.details.popularity;
                                                                                                                                            optS.loudness = s.details.loudness;
                                                                                                                                            optS.energy = s.analytics.energy;
                                                                                                                                            optS.danceability = s.analytics.danceability;
                                                                                                                                            optS.liveness = s.analytics.liveness;
                                                                                                                                            optS.valence = s.analytics.valence;
                                                                                                                                            optS.acousticness = s.analytics.acousticness;
                                                                                                                                            optS.speechiness = s.analytics.speechiness;

                                                                                                                                        songSel.appendChild(optS);
                                                                                                                                        songSelByArt.appendChild(optS);

                                                                                                                                    }

                                                                                                                                    }
                                                                                                                                    songSel.addEventListener('click', function (e) {
                                                                                                                                        if (e.target.tagName.toLowerCase() === 'option') {
                                                                                                                                            console.log(e.target.title + ' clicked');

                                                                                                                                        loadSongResults(e.target);
                                                                                                                                        //pass in the song-object for the browse/search
                                                                                                                                        songsDisplayed(e.target);
                                                                                                                                        //takes you to selected song info
                                                                                                                                        const charti = document.querySelector("#right3");
                                                                                                                                        charti.style.display = "block";

                                                                                                                                        makeChart(e.target);
                                                                                                                                    }
                                                                                                                                })
                                                                                                                                }


</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {

        const artistAPI = "starting-files/artists.json";
        const songsAPI = 'https://www.randyconnolly.com/funwebdev/3rd/api/music/songs-nested.php';

        const getArtistsButton = document.querySelector("#getArtists");
        const getSongsButton = document.querySelector("#getSongs");
        const getGenreButton = document.querySelector("#getGenres");
        const realSearch = document.querySelector("#realSearch");
        const artistsList = document.querySelector("#artistsList");
        const songsList = document.querySelector("#songsList");
        const genreList = document.querySelector("#genreList");
        const artistSongs = document.querySelector("#songsFromArtistList");
        artistsList.style.display = "none";
        songsList.style.display = "none";
        genreList.style.display = "none";
        artistSongs.style.display="none";

        getArtistsButton.addEventListener('click', displayAllArtists);
        getSongsButton.addEventListener('click', displayAllSongs);
        getGenreButton.addEventListener('click', displayAllGenres);


        function displayAllArtists() {
            fetch(artistAPI)
                .then(resp => resp.json())
                .then(artistsData => {
                    artistsList.style.display = "block";
                    songsList.style.display = "none";
                    genreList.style.display = "none";
                    artistsData.forEach(c => {
                        const opt = document.createElement('option');
                        opt.value = c.name;
                        opt.textContent = c.name;
                        artistsList.appendChild(opt);
                    });
                    //Load the songs list
        
                    artistsList.addEventListener('input', displayAllSongs);
                    // artistsList.addEventListener('input', loadSongListOf(artist));
                })
        }
                    

        function displayAllSongs() {
            fetch(songsAPI)
                .then(resp => resp.json())
                .then(songsData => {
                    artistsList.style.display = "block";
                    songsList.style.display = "block";
        
                    genreList.style.display = "none";
                    songsData.forEach(s => {
                        const optS = document.createElement("option");
                        optS.value = s.song_id;
                        optS.textContent = s.title;
                        optS.songID = s.song_id;
                        optS.title = s.title;
                        optS.year = s.year;
                        optS.artistID = s.artist.id;
                        optS.artist = s.artist.name;
                        optS.genreID = s.genre.id;
                        optS.genre = s.genre.name;
                        optS.durationInSec = s.details.duration;
                        optS.bpm = s.details.bpm;
                        optS.popul = s.details.popularity;
                        optS.loudness = s.details.loudness;
                        optS.energy = s.analytics.energy;
                        optS.danceability = s.analytics.danceability;
                        optS.liveness = s.analytics.liveness;
                        optS.valence = s.analytics.valence;
                        optS.acousticness = s.analytics.acousticness;
                        optS.speechiness = s.analytics.speechiness;
                        songsList.appendChild(optS);
                    });
                    //add load song info
                    // songsList.addEventListener('input', loadSongData());
                    // songsList.addEventListener('input', loadSongOntoPlaylist());
                    // songsList.addEventListener('input', loadSongIntoHistory());
                })
        }

        function displayAllGenres() {
            // console.log(s.genre);
            fetch(songsAPI)
                .then(resp => resp.json())
                .then(genreData => {
                    songsList.style.display = "none";
                    artistsList.style.display = "none";
                    genreList.style.display = "block";
                    genreData.forEach(g => {
                        const optG = document.createElement("option");
                        optG.value = g.genre.id;
                        optG.textContent = g.genre.name;
                        genreList.appendChild(optG);

                    })
                })
        }
        
        function loadSongListOf(artist){
            //foreach song for this artist
            for(song of artist){
                forEach(artist => {
                        const optSL = document.createElement("option");
                        optSL.value = "";
                        optSL.textContent = "";
                        genreList.appendChild(optSL);
                })
        
            }
    }
})

   
                   </script>

<header>
    <h1>What I should've done first</h1>
    <button id="getGenres">Search By Genre</button>
    <button id="getArtists">Search By Artists</button>
    <button id="getSongs">Search By Songs</button>
    <br>
</header>
<main>
    <section id="realSearch">
        <select name="genreList" id="genreList">Only exists if Genre Button is Clicked</select>
        <br>
        <select name="artistsList" id="artistsList">Only exists if Artist Button is Clicked</select>
        <br>
        <select name="songsList" id="songsList">Usually exists if Song Button is Clicked</select>
        <br>
        <select name="songsFromArtistList" id="songsFromArtistList">Only exists if Artist Button was Clicked then an Artist Selected</select>

    </section>

    <section id="results">
        <h1>Browse/Search Results</h1>

        <table id="resultsDisplay">
            <tr>
                <th>Title</th>
                <th>Artist</th>
                <th>Year</th>
                <th>Genre</th>
                <th>Popularity</th>
                <th>Button</th>
            </tr>
        </table>

    </section>
</main>

<footer>
    <h2>FOOTER</h2>
</footer>
</body>
<!-- Putting Scripts Here -->

<!-- Putting Styles Here -->

</html>