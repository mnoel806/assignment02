<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mattington's Musical Adventure!</title>
<link rel="stylesheet" href="./styleA.css">
<script src="./js/myFuncts.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<!-- leave what is repeatable for now -->
<!-- Sometimes when I comment things out, a 
    linter tries to use "hidden" braces and screw with my code -->
<body>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        //load Artists

        const artistURL = "starting-files/artists.json";
        const artistSel = document.querySelector("#artistSearch");
        const songSel = document.querySelector("#songSearch");
        //Now Fetching Artists
        fetch(artistURL)
            .then(response => response.json())
            .then(data => { populateArtists(data) })
        const optArt = document.createElement("option");
        optArt.textContent = "Pick an Artist";
        optArt.value = 0;
        artistSel.appendChild(optArt);

        function populateArtists(artistData) {
            for (let art of artistData) {
                const optA = document.createElement("option");
                optA.textContent = art.name;
                optA.name = art.name;
                optA.id = art.id;
                optA.type = art.type;
                // optA.addEventListener("click", function () {
                //     this.classList.add("selected");
                // });
                artistSel.appendChild(optA);

            }//End of options being populated


        }
        artistSel.onclick = function (e) {
            if (e.target.tagName.toLowerCase() === 'option') {
                console.log(e.target.name + ' clicked');
                if (it > 0) {
                    loadSongs();
                }
                //only load the songs from the selected artist next+
                loadArtResults(e.target);
                songsDisplayed(e.target);


            }
        }
    });


        function loadSongs() {
            const api = 'http://www.randyconnolly.com/funwebdev/3rd/api/music/songs-nested.php';
            // const songURL = "starting-files/sample-songs.json";
            const songSel = document.querySelector("#songSearch");
            fetch(api)
                .then(response => response.json())
                .then(data => { populateSongs(data) })
            const opt1 = document.createElement("option");
            opt1.textContent = "Pick a Song";
            opt1.value = 0;
            const it = 0;
            // songSel.addEventListener("click", function () {
            //     this.classList.add("selected");
            // });
            songSel.appendChild(opt1);

            function populateSongs(songData) {
                for (let s of songData) {
                    const optS = document.createElement("option");
                    optS.textContent = s.title;
                    optS.songID = s.song_id;
                    optS.title = s.title;
                    optS.year = s.year;
                    optS.artistID = s.artist.id;
                    optS.artist = s.artist.name;
                    optS.genreID = s.genre.id;
                    optS.genre = s.genre.name;
                    optS.durationInSec = s.details.duration;
                    optS.bpm = s.details.bpm;
                    optS.popul = s.details.popularity;
                    optS.loudness = s.details.loudness;
                    optS.energy = s.analytics.energy;
                    optS.danceability = s.analytics.danceability;
                    optS.liveness = s.analytics.liveness;
                    optS.valence = s.analytics.valence;
                    optS.acousticness = s.analytics.acousticness;
                    optS.speechiness = s.analytics.speechiness;

                    songSel.appendChild(optS);
                }
                it++;
            }
            songSel.addEventListener('click', function (e) {
                if (e.target.tagName.toLowerCase() === 'option') {
                    console.log(e.target.title + ' clicked');

                    loadSongResults(e.target);
                    //pass in the song-object for the browse/search
                    songsDisplayed(e.target);
                    //takes you to selected song info
                    const charti = document.querySelector("#right3");
                    charti.style.display = "block";

                    makeChart(e.target);
                }
            })
        }


</script>

<div class="displayer" id="search-view"> <!-- SongSearchView -->
    <header id="head0">
        <h1>Songs n Stuff</h1>
        <!-- Title to be dynamic later -->
    <!-- <button id="playlistBTN">.onClick(GoToPlaylist())</button> -->
    <button id="repoBtn" onClick="goToRepo()">Click => goToRepo</button>
    <button id="reloader" onClick="location.reload()">RELOAD</button>
    <!-- <button id="showSearch" onClick="showSearchView()">showSearch</button> -->
    <button id="showSong" onClick="showSongView()">showSong</button>
    <button id="showPlaylist" onClick="showPlaylistView()">showPlaylist</button>
    </header>

<!-- These sections will be replaced as the user does the navigating -->
<section id="left1">
    <h1>Basic Search</h1>
<!-- <form id="search-form" action="">
<p>Search type:</p>
<input type="radio" name="search-options" id="search-title">
<label for="search-title">Song Title ${all.the.titles}(Dropdown)</label><br>
<input type="radio" name="search-options" id="search-artist">
<label for="search-options">Artist Name ${all.the.artists}</label><br>
<input type="radio" name="search-options" id="search-genre">
<label for="search-options">Genre ${all.the.genres}</label><br>
<br>
<input type="submit" value="Submit">
<input type="reset" value="Clear">
</form> -->
<button id="btnswp01" onClick="artSongSwap(), loadSongs()">Search By Song</button>
<button id="btnswp02" onClick="artSongSwap()">Search By Artist</button> <br>
    <div id="searcher">
        <select name="artistSearch" id="artistSearch" textContext="Pick me"></select>
        <select name="songSearch" id="songSearch"></select>
        <!-- <select name="genreSearch" id="genreSearch"></select> -->
    </div>
</section>
<!-- this will be for that searchform once it's fully functional -->


<section id="centre2">
<h1>Browse/Search Results</h1>

<table id="resultsDisplay">
        <tr>
            <th>Title</th>
            <th>Artist</th>
            <th>Year</th>
            <th>Genre</th>
            <th>Popularity</th>
            <th>Button</th>
        </tr>
</table>

</section>



</div>

<div class="displayer" id="song-view"> <!-- SingleSongView -->
    <header id="head0">
        <h1>$SingleSongView</h1>
        <button id="repoBtn" onClick="goToRepo()">Click => goToRepo</button>
        <button id="reloader" onClick="location.reload()">RELOAD</button>
        <button id="showSearch" onClick="showSearchView()">showSearch</button>
        <!-- <button id="showSong" onClick="showSongView()">showSong</button> -->
        <button id="showPlaylist" onClick="showPlaylistView()">showPlaylist</button>
        </header>
    <section id="left1">
        <h2>Song Information</h2>
        <div id="songInfos"></div>
        <h2>Analysis of Data</h2>
        <ul id="analysisData"></ul>
        </section>



        <section style="display:none" id="right3">

            <div style="display:block">
                <canvas id="myChart"></canvas>
            </div>
            <!-- Chart Base from: (https://www.chartjs.org) -->
            <div id="theChartBox1">
                <div>
                    <canvas id="myChart"></canvas>
                </div>
        
            </div>
            </section>

</div>

<div class="displayer" id="playlist-view"> <!-- PlaylistView -->
    <header id="head0">
        <h1>$PlaylistView</h1>
        <button id="repoBtn" onClick="goToRepo()">Click => goToRepo</button>
        <button id="reloader" onClick="location.reload()">RELOAD</button>
        <button id="showSearch" onClick="showSearchView()">showSearch</button>
        <button id="showSong" onClick="showSongView()">showSong</button>
        <!-- <button id="showPlaylist" onClick="showPlaylistView()">showPlaylist</button> -->
    </header>

<section id="left1">
    <div>
        <h1>Playlist Details</h1>
        <p>${#ofsongsinlist}</p>
        <p>${popularityrankings?}</p>
    </div>

<table id="playlistTable">
    <tr>
        <th>Title
            <!-- <div id="sortButtons">
<button id="sortASC" onClick="sortResultsAsc()">ASC</button>
<button id="sortDSC" onClick="sortResultsDsc()">DSC</button>
</div> -->
        </th>
        <th>Artist</th>
        <th>Year</th>
        <th>Genre</th>
        <th>Popularity</th>
        <th>""</th>
    </tr>
    <!-- forEachEntryinPlaylist -->
    <!-- createElement("<tr>");
createElement("<td><a href="goToSongPage($t)">")
createElement("</a></td>")
createElement("<td>a")
createElement("</a></td>") -->
    <tr>
        <td>1</td>
        <td>2</td>
        <td>3</td>
        <td>4</td>
        <td>5</td>
        <td><button>RMV</button></td>
    </tr>
    <!-- Endof"Loop" -->
</table>

</section>


<section id="centre2">

</section>
</div>

<footer>
    <h2>FOOTER</h2>
</footer>
</body>
<!-- Putting Scripts Here -->

<!-- Putting Styles Here -->

</html>