<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Matthew's Musical Adventure!</title>
<!-- <link rel="stylesheet" href="./styleA.css"> -->
<link rel="stylesheet" href="./styleB.css">
<script src="./js/myFuncts.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<!-- Do what you can -->
<body>


<script>
                                                                        document.addEventListener("DOMContentLoaded", function () {

                                                                        const artistAPI = "starting-files/artists.json";
                                                                        const songsAPI = 'https://www.randyconnolly.com/funwebdev/3rd/api/music/songs-nested.php';

                                                                        const songsArr = [];
                                                                        const artsArr = [];
                                                                        const genreArr = [];

                                                                        const getArtistsButton = document.querySelector("#getArtists");
                                                                        const getSongsButton = document.querySelector("#getSongs");
                                                                        const getGenreButton = document.querySelector("#getGenres");
                                                                        const filters = document.querySelector("#filters");
                                                                        const artsList = document.querySelector("#artistsList");
                                                                        const songsLt = document.querySelector("#songsList");
                                                                        const genreList = document.querySelector("#genreList");
                                                                        const artistSongs = document.querySelector("#songsFromArtistList");

                                                                        artsList.style.display = "none";
                                                                        songsLt.style.display = "none";
                                                                        genreList.style.display = "none";
                                                                        artistSongs.style.display = "none";

                                                                        getArtistsButton.addEventListener('click', displayAllArtists);
                                                                        getSongsButton.addEventListener('click', displayAllSongs);
                                                                        getGenreButton.addEventListener('click', displayAllGenres);

                                                                        fetch(songsAPI)
                                                                            .then(resp => resp.json())
                                                                            .then(artistsData => {
                                                                            localStorage.setItem('musicDat', JSON.stringify(artistsData));
                                                                        })

                                                                        function displayAllSongs() {
                                                                            artsList.style.display = "none";
                                                                            songsLt.style.display = "block";
                                                                            genreList.style.display = "none";
                                                                        console.log("Songs am clicked");
                                                                        filters.style.display = "block";

                                                                        const musicDat = retrieveStorage();
                                                                        musicDat.forEach(s => {
                                                                            const opt = document.createElement('option');
                                                                        opt.setAttribute('value', s.song_id);
                                                                        opt.setAttribute('textContent', s.title);
                                                                        opt.textContent = s.title;
                                                                        opt.songID = s.song_id;
                                                                        opt.title = s.title;
                                                                        opt.year = s.year;
                                                                        opt.artistID = s.artist.id;
                                                                        opt.artist = s.artist.name;
                                                                        opt.genreID = s.genre.id;
                                                                        opt.genre = s.genre.name;
                                                                        opt.durationInSec = s.details.duration;
                                                                        opt.bpm = s.details.bpm;
                                                                        opt.popul = s.details.popularity;
                                                                        opt.loudness = s.details.loudness;
                                                                        opt.energy = s.analytics.energy;
                                                                        opt.danceability = s.analytics.danceability;
                                                                        opt.liveness = s.analytics.liveness;
                                                                        opt.valence = s.analytics.valence;
                                                                        opt.acousticness = s.analytics.acousticness;
                                                                        opt.speechiness = s.analytics.speechiness;
                                                                        songsLt.appendChild(opt);
                                                                    });
                                                                            document.querySelector("#songsList > option:nth-child(2)")
                                                                            const slt = document.querySelectorAll("#songsList > option");
                                                                            //Event Handlers
                                                                            songsLt.addEventListener('input', (e) => {
                                                                                console.log(e.target);
                                                                                loadSongResults(e.target);
                                                                            })

                                                                        }


                                                                        function displayAllArtists() {
                                                                            console.log("Artists am clicked");
                                                                            artsList.style.display = "block";
                                                                            songsLt.style.display = "none";
                                                                            genreList.style.display = "none";
                                                                            filters.style.display = "block";

                                                                            const musicDat = retrieveStorage();
                                                                            musicDat.forEach(a => {
                                                                                const optA = document.createElement('option');
                                                                                optA.setAttribute('value', a.artist.id);
                                                                                optA.setAttribute('textContent', a.artist.name);
                                                                                optA.textContent = a.artist.name;
                                                                                optA.artistID = a.artist.id;
                                                                                optA.artist = a.artist.name;

                                                                                artsList.appendChild(optA);

                                                                            })

                                                                        artsList.addEventListener('input', (e) => {
                                                                            console.log(e.target.value);
                                                                            displayAllSongs();
                                                                        })
                                                                    }




                                                                        // STORAGE FUNCTIONS

                                                                        function retrieveStorage() {
                                                                            return JSON.parse(localStorage.getItem('musicDat')) || [];
                                                                        }

                                                                        function updateStorage(artistsData) {
                                                                            localStorage.setItem('musicDat', JSON.stringify(artistsData));
                                                                        }

                                                                        function emptyStorage() {
                                                                            localStorage.removeItem('musicDat');
                                                                        }
                                                                        function displayAllGenres() {
                                                                            // console.log(s.genre);
                                                                            fetch(songsAPI)
                                                                                .then(resp => resp.json())
                                                                                .then(genreData => {
                                                                                    songsList.style.display = "none";
                                                                                    artistsList.style.display = "none";
                                                                                    genreList.style.display = "block";
                                                                                    genreData.forEach(g => {
                                                                                        const optG = document.createElement("option");
                                                                                        optG.value = g.genre.id;
                                                                                        optG.textContent = g.genre.name;
                                                                                        genreList.appendChild(optG);
                                                                                })
                                                                            })
                                                                    }

                                                                        function loadSongResults(val) {
                                                                            console.log(val);

                                                                            // const selectedSong = retrieveStorage()
                                                                            const oneSong = val.filter(song => song.song_id = 1167);

                                                                            let indexSong = [];


                                                                            // song.filter(
                                                                            //     oneSong => oneSong.value = val
                                                                            // );
                                                                            console.log(oneSong);
                                                                            let song = val;

                                                                        const theList = document.querySelector("#resultsDisplay");
                                                                        const tr1 = document.createElement("tr");
                                                                        const td1 = document.createElement("td");
                                                                        td1.textContent = song.title;
                                                                        // alert(song.title);
                                                                        tr1.appendChild(td1);
                                                                        const td2 = document.createElement("td");
                                                                        td2.textContent = song.artist;
                                                                        tr1.appendChild(td2);
                                                                        const td3 = document.createElement("td");
                                                                        td3.textContent = song.year;
                                                                        tr1.appendChild(td3);
                                                                        const td4 = document.createElement("td");
                                                                        td4.textContent = song.genre;
                                                                        tr1.appendChild(td4);
                                                                        const td5 = document.createElement("td");
                                                                        td5.textContent = song.popul;
                                                                        tr1.appendChild(td5);
                                                                        const td6 = document.createElement("button");
                                                                        td6.textContent = "ADD";
                                                                        tr1.appendChild(td6);
                                                                        theList.appendChild(tr1);
                                                                    }
                                                                    }) //END OF DOMLOAD



</script>

<header>
<section class="box">
    <h1>What I should've done</h1>

    <button id="getArtists">Search By Artists</button>
<button id="getGenres">Search By Genre</button>
<button id="getSongs">Search By Songs</button>
<br>
</section>
</header>
<main class="container">
    <section class="box">
        <ul id="eosA"></ul>
        <ul id="eosB"></ul>
        <ul id="eosC"></ul>
    </section>

    <section id="filters" class="box">
        <article>
            <select name="theArtistsList" id="artistsList">Pick an Artist
            </select>
            <br>
<select name="theSongsList" id="songsList" class="resultsList">Pick a Song
</select>
<br>
<select name="theGenreList" id="genreList">Pick Genre
</select>
<br>
<select name="theSongsFromArtistList" id="songsFromArtistList">Only exists if Artist Button was Clicked then an Artist
    Selected</select>
</article>
<div></div>

</section>

<section id="results" class="box">
    <h1>Browse/Search Results</h1>

<table id="resultsDisplay">
    <tr>
        <th>Title</th>
        <th>Artist</th>
        <th>Year</th>
        <th>Genre</th>
        <th>Popularity</th>
        <th>Button</th>
    </tr>
</table>

</section>
<section id="left1" style="display:none">
    <h1>Basic Search</h1>


    <div id="searcher">
        <select name="artistSearch" id="artistSearch" textContext="Pick me"></select>
        <select name="songSearch" id="songSearch"></select>
        <select name="songSearchByArt" id="songSearchByArt">"Pick me"</select>
        <!-- <select name="genreSearch" id="genreSearch"></select> -->
    </div>
    <br>
    <button id="btnswp01" onClick="artSongSwap()">Click to Search By Song</button>
    <button id="btnswp02" onClick="artSongSwap()">Click to Search By Artist</button>
</section>

<section id="left1" class="box">
    <h2>Song Information</h2>
    <div id="songInfos"></div>
    <h2>Analysis of Data</h2>
    <ul id="analysisData"></ul>
</section>

</main>


<footer>
<h2>FOOTER</h2>
</footer>
</body>
<!-- Putting Scripts Here -->

<!-- Putting Styles Here -->

</html>